---
title: Bandwith, coverage, monitoring and other types of Voodoo
date: 2017-07-06 13:37 UTC
author: stb
tags: mikrotik, wifi, sysadmin
---
<%= image_tag('how-we-got-here.jpg') %>
As a sysadmin at Panter you are also responsible for the infrastructure of the
ImpactHub Zürich, a vibrant coworking space in the heart of Zürich. On three floors
and a total of roughly 2000 square meters, we’re making sure that up to 800 members
fit into our WiFi network, as always in such a crowded place there is not much of
a margin for errors.Since our frequencies are almost as crowded with rogue WiFis,
as the deathstar’s having holes for thermonuclear missiles, this can be quite
challenging and frustrating at times.

[![Youtube:Steve Jobs 500 WiFi Basestations](jobs.jpg)](https://youtu.be/1-oIL9cLHDc?t=19 "Steve Jobs WiFi")

In this blog post we would like to give you an insight view of our configuration and
how we are troubleshooting our network. To begin with, our WiFi runs exclusively on
Mikrotik devices because they provide with the flexibility needed. The devices come
at a fair price and we are not forced to pay fees to use their products.When we first
got to the Impact Hub Zürich  we had nothing but an empty rack, an old DIY router
and some broken cables. Step by step we have built up the infrastructure adjusting
it to our needs.

## The dawn of WiFi![Shabby AP](ShabbyAP.jpg)
We started out with an emergency setup (2 access points) as we had to move into
the new location faster than expected. In the beginning, there was not much of a
concept, but it worked out just fine for a small crowd of about twenty-five Panters.
While we were having our office in the middle of a nearly finished construction site,
it was quite dusty at the time. Consequently, we even managed to nearly kill our router
because it suffocated in the dust (the whole rack was accidentally covered in dust).
Luckily, it was something that could be solved with a little bit of compressed air!

![Bunch of Cables](CableBunch.jpg)
For sure working on a construction site has its downsides, but it also gives you
the freedom to plan the location of your LAN outlets, or so we thought, but the
construction plans changed and those outlets remain a vision. We had to reverse
engineer every single one those cables because the documentation of the existing
network was nonexistent.

When we first moved to the Impact Hub our network rack was neat and clean with almost no
cables. We also had to reverse-engineer all of the cables by ourselves
because there were no plans or documentation of the previous network,
the top floor was a dusty attic, which looked like it hadn’t been touched
for at least half a decade. Since then all visible and nonvisible LAN
outlets were patched, feel free to use them if you spot one at the Impact Hub Zürich.

![Before and after](beforeAfter.jpg)

With the help of our network cracks, we've got a solid setup and started to use
Mikrotiks CAPsMAN, which is a bit of a hassle to wrap your head around at first,
but after the initial setup it works like a charm (and 10 factory resets later).

## Perception

There is always a gap between sysadmins and users when it comes to
quality. We are pretty much the only fans of cabled connection. We love the convenience
of cables and because we already had a lot of LAN ports in this building, (a school back in the day)
our vision was an AP & switch combo on every table, so people who needed WiFi could
get it from either Ether or use cables as they desire. Oh well, that idea got
chased out of town pretty fast. Except the [makerZspace](https://makerzspace.ch/),
they love cables and still got them.

So we decided to aim for 5G coverage and to slowly starve out 2.4G, because it's
way faster and allows you to put up a higher density of AP's. Furthermore, if less
people use one single access point everyone will have a faster connection, we thought.
We are living in the year 2015 where almost every device is capable of 5G, so there
shouldn't be an issue with partially dropping 2.4G, right? **TOTALLY WRONG**

![ClientBandDistribution](ClientBandDistribution.jpg)

As it turns out 5G capable devices aren't always working great with 5G connectivity,
since most of those devices only support the lower bands 5-036 & 5-044.
Yet in our office buildings there are hollow glass bricks between our meeting rooms,
which are a dead-end road for every 5G connection. Furthermore, there are also quite
some differences amongst the various products Mikrotiks offers. Here is a list of
a few we went through and the ones we are currently using :

### Legacy AP's
* [Netmetal](https://routerboard.com/RB922UAGS-5HPacT-NM) - A lot of DIY, very time consuming and comparably not very affordable nearly indestructible and perfect for the outdoors
* [Netbox](https://routerboard.com/RB911G-5HPacD-NB) - Also DIY, pretty massive and quite expensive, also not the most aesthetic one
* [cAP2n](https://routerboard.com/RBcAP2nD) - Plastic toy, wouldn't recommend

### Current AP's
* [wAP](https://routerboard.com/RBwAPG-5HacT2HnD) - Aesthetic, well designeddualband accesspoints with a good range
* [SXT SA5 ac](https://routerboard.com/RBSXTG-5HPacD-SA) - With a 90° angleperfect for the corners in our coworking space
* [wAP ac](https://routerboard.com/RBwAPG-5HacT2HnD) - very fast, performant AP
* [hAP ac](https://routerboard.com/RB962UiGS-5HacT2HnT) - similar to the wAP ac but comes with a built in switch

In order to provide everybody in the house with a great connection, we are also pretty harsh when it comes down to kicking people with a slow connection out of our access points, because their signal strength,slows everybody’s connection down, thus other users ofthat access point a bad time.. Meaning if you’re connected on the 5G radio on a dualband access point and at the same time you share this access point with 10 users using the 2.4G radio, you will automatically be slowed down by the “legacy” of those 2.4G users. Therefore, it is important to limit a user’s signal. When we lowered the connectivity threshold to the sysadmins sweet spot of 65[dBm](https://en.wikipedia.org/wiki/DBm) we had an awesome connection, but somehow all the other non-sysadmin users were having a bad time, this is the point you have to realize that you obviously have another perception of "things going well" (although you're right and there are still just too many devices only capable of 2.4G). At the moment we are running 20 AP's on 3 floors, serving over 300 clients during peak hours.

![ClientsPerAP](ClientsPerAP.jpg)

Keeping in mind that with the many different devices and the complete freedom to
use every device you desire in our coworking space, there will always be some
people having connectivity issues.
Therefore, with a growing member count our knowhow about the monitoring and
distribution of the load amongst our network and infrastructure becomes increasingly important.

![TrafficPerAP](TrafficPerAP.jpg)

## Monitoring

If you are responsible for something which many people rely on every
day, you as a sysadmin should be able to tell someone where the problem comes from.
In our case at the Impact Hub Zürich, it's quite important to monitor the radio waves,
so we can start investigating rising issues before the majority of the people are
affected by it and to troubleshoot specific clients' issues.

As we have other offices and schools around us, we are sometimes experiencing a
peak in traffic. We’ve noticed that the peak usually occurs during the breaks of
schoolkids, meaning we see them sitting outside the building on their smartphones
most likely using our  free WiFi, which is intended for the visitors of the coworking
space. Therefore, we found it important to drop clients that are too far away with
a low signal (across the street / inside the school building), that's why we are
constantly monitoring our frequencies and repositioning our AP's, which allows
us to to supply our guests with a good connection (that's also where our fancy graphs come from).

![SignalStats](SignalStats.jpg)

In addition, we are  also periodically mapping out our coworking space to check
for coverage issues,noise sources, interferences and overlapping channels.

![SignalLevel](SignalLevel.jpg)

During this continued learning process, we also went on to develop our own self-service
portal through which members of the Impact Hub connected to our network can send
us a ratings directly to the company chat, as well as chasing the issue themselves.

![Shazaam](Shazaam.jpg)

We have have even managed to supply our guests with an Intranet dashboard in which
they can check their WiFi performance using Prometheus to save the time series and
Grafana to visualize them.

![Dashboard](DashboardWifi.jpg)

The many experiences we accumulated have led us to open source this project, which
as soon as we complete it, will be available to you to tinker with. It should work
on all CAPsMAN enabled Mikrotik Networks, so make sure to follow us on one of our
channels to get the news as soon as we publish it.
